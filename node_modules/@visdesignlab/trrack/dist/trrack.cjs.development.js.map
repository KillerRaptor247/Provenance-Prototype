{"version":3,"file":"trrack.cjs.development.js","sources":["../src/Utils/DeepCopy.ts","../src/Types/Nodes.ts","../src/Utils/defaultDeserializer.ts","../src/Utils/defaultSerializer.ts","../src/Utils/generateTimeStamp.ts","../src/Utils/Differ.ts","../src/Utils/generateUUID.ts","../src/Provenance/ProvenanceGraphFunction.ts","../src/Provenance/ProvenanceCreator.ts","../src/Provenance/ActionCreator.ts"],"sourcesContent":["/* eslint-disable no-shadow */\n// TODO:: Fix typing, target shouldnt be of type T.\n\n// eslint-disable-next-line no-unused-vars\nexport default function deepCopy<T>(target: T): T {\n  return JSON.parse(JSON.stringify(target));\n}\n","/* eslint-disable no-shadow */\nimport { applyChange, Diff } from 'deep-diff';\nimport { toJS } from 'mobx';\nimport deepCopy from '../Utils/DeepCopy';\nimport { ActionType } from './Action';\nimport { ProvenanceGraph } from './ProvenanceGraph';\nimport { JsonValue } from './Serializers';\n\nexport type DiffExport<L, R = L> = Diff<L, R>;\n\nexport type NodeID = string;\n\nexport type Meta = { [key: string]: any };\n\nexport type NodeMetadata<S> = {\n  createdOn?: number;\n  eventType: S | 'Root';\n} & Meta;\n\ntype BaseArtifact = {\n  timestamp: number;\n};\n\nexport type Annotation = BaseArtifact & {\n  annotation: string;\n};\n\nexport type Artifact<A> = BaseArtifact & {\n  artifact: A;\n};\n\nexport type Artifacts<A> = {\n  annotations: Annotation[];\n  customArtifacts: Artifact<A>[];\n};\n\nexport interface BaseNode<S> {\n  id: NodeID;\n  label: string;\n  metadata: NodeMetadata<S>;\n  children: NodeID[];\n  actionType: ActionType;\n  bookmarked: boolean;\n}\n\nexport interface RootNode<S> extends BaseNode<S> {\n  state: JsonValue;\n}\n\nexport interface ChildNode<S, A> extends BaseNode<S> {\n  parent: NodeID;\n  artifacts: Artifacts<A>;\n}\n\nexport interface StateNode<S, A> extends RootNode<S>, ChildNode<S, A> {}\n\nexport interface DiffNode<S, A> extends ChildNode<S, A> {\n  diffs: Diff<JsonValue>[];\n  lastStateNode: NodeID;\n}\n\nexport type ProvenanceNode<S, A> = RootNode<S> | StateNode<S, A> | DiffNode<S, A>;\n\nexport type Nodes<S, A> = { [key: string]: ProvenanceNode<S, A> };\n\nexport type CurrentNode<S, A> = ProvenanceNode<S, A>;\n\n/**\n * Function for checking if a node is a state node.\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n * Extra is a way to store customized metadata.\n * @param _opts: Given node to check if it is a state node.\n */\nexport function isStateNode<S, A>(node: ProvenanceNode<S, A>): node is StateNode<S, A> {\n  return 'parent' in node && 'state' in node;\n}\n\n/**\n * Function for checking if a node is a diff node.\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n * Extra is a way to store customized metadata.\n * @param _opts: Given node to check if it is a diff node.\n */\nexport function isDiffNode<S, A>(node: ProvenanceNode<S, A>): node is DiffNode<S, A> {\n  return 'diffs' in node;\n}\n\n/**\n * Function for checking if a node is a child node.\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n *  Extra is a way to store customized metadata.\n * @param _opts: Given node to check if it is a child node.\n */\nexport function isChildNode<S, A>(\n  node: ProvenanceNode<S, A>,\n): node is DiffNode<S, A> | StateNode<S, A> {\n  return 'parent' in node;\n}\n\n/**\n * Function for checking if a node is the root node.\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n * Extra is a way to store customized metadata.\n * @param _opts: Given node to check if it is root.\n */\nexport function isRootNode<S, A>(node: ProvenanceNode<S, A>): node is RootNode<S> {\n  return node.label === 'Root';\n}\n\n/**\n`* Retrieve the state of a node. `\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n * Extra is a way to store customized metadata.\n * @param graph: Provenance Graph which we are searching for node in\n * @param _opts: Node which we want the state of\n */\nexport function getState<S, A>(\n  graph: ProvenanceGraph<S, A>,\n  node: ProvenanceNode<S, A>,\n): JsonValue {\n  if (isRootNode(node) || isStateNode(node)) {\n    return toJS(node.state);\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  const _state = toJS((graph.nodes[node.lastStateNode] as StateNode<S, A>).state);\n\n  const state = deepCopy(_state);\n\n  // what is this for?\n  node.diffs.forEach((diff) => {\n    applyChange(state, null, diff);\n  });\n\n  return state;\n}\n","import { JsonValue } from '../Types/Serializers';\n\nfunction defaultDeserializer<T>(o: JsonValue): T {\n  const str = JSON.stringify(o);\n  const obj = JSON.parse(str, (_, val) => {\n    if (!val) return val;\n\n    if (val.type && val.type === 'Set') {\n      return new Set(val.arr);\n    }\n    if (val.type && val.type === 'Map') {\n      return new Map(Object.entries(val.obj));\n    }\n    return val;\n  });\n\n  return obj;\n}\n\nexport default defaultDeserializer;\n","import { toJS } from 'mobx';\nimport { JsonValue } from '../Types/Serializers';\n\nfunction defaultSerializer<T>(obj: T): JsonValue {\n  if (!obj) return {};\n\n  const str = JSON.stringify(toJS(obj), (_, val) => {\n    if (val instanceof Set) {\n      return {\n        type: 'Set',\n        arr: Array.from(val),\n      };\n    }\n    if (val instanceof Map) {\n      return {\n        type: 'Map',\n        obj: Object.fromEntries(val),\n      };\n    }\n    return val;\n  });\n\n  return JSON.parse(str);\n}\n\nexport default defaultSerializer;\n","export default function generateTimeStamp(): number {\n  return new Date().getTime();\n}\n","import { diff } from 'deep-diff';\n\nexport default function differ<T>(obj1: T, obj2: T) {\n  return diff(obj1, obj2);\n}\n","/* eslint-disable no-bitwise */\nexport default function generateUUID(): string {\n  let d = new Date().getTime();\n\n  d += new Date().valueOf();\n\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n","/* eslint-disable no-shadow */\nimport { Diff } from 'deep-diff';\nimport { action } from 'mobx';\nimport { ActionType, ApplyObject } from '../Types/Action';\nimport {\n  DiffNode,\n  getState,\n  isChildNode,\n  isDiffNode,\n  Meta,\n  NodeID,\n  RootNode,\n  StateNode,\n} from '../Types/Nodes';\nimport { ProvenanceGraph } from '../Types/ProvenanceGraph';\nimport { JsonValue, Serializer } from '../Types/Serializers';\nimport differ from '../Utils/Differ';\nimport generateTimeStamp from '../Utils/generateTimeStamp';\nimport generateUUID from '../Utils/generateUUID';\n\nexport function createProvenanceGraph<S, A>(state: JsonValue): ProvenanceGraph<S, A> {\n  const root: RootNode<S> = {\n    id: generateUUID(),\n    label: 'Root',\n    metadata: {\n      createdOn: generateTimeStamp(),\n      eventType: 'Root',\n    },\n    children: [],\n    state,\n    actionType: 'Regular',\n    bookmarked: false,\n  };\n\n  const graph: ProvenanceGraph<S, A> = {\n    nodes: {\n      [root.id]: root,\n    },\n    root: root.id,\n    current: root.id,\n  };\n\n  return graph;\n}\n\nfunction createNewStateNode<S, A>(\n  parent: NodeID,\n  state: JsonValue,\n  label: string,\n  actionType: ActionType,\n  eventType: S,\n  meta: Meta,\n): StateNode<S, A> {\n  return {\n    id: generateUUID(),\n    label,\n    metadata: {\n      createdOn: generateTimeStamp(),\n      eventType,\n      ...meta,\n    },\n    artifacts: {\n      annotations: [],\n      customArtifacts: [],\n    },\n    parent,\n    children: [],\n    state,\n    actionType,\n    bookmarked: false,\n  };\n}\n\nfunction createNewDiffNode<S, A>(\n  parent: NodeID,\n  label: string,\n  diffs: Diff<JsonValue>[],\n  actionType: ActionType,\n  previousStateId: NodeID,\n  eventType: S,\n  meta: Meta,\n): DiffNode<S, A> {\n  return {\n    id: generateUUID(),\n    label,\n    metadata: {\n      createdOn: generateTimeStamp(),\n      eventType,\n      ...meta,\n    },\n    artifacts: {\n      annotations: [],\n      customArtifacts: [],\n    },\n    parent,\n    children: [],\n    lastStateNode: previousStateId,\n    diffs,\n    actionType,\n    bookmarked: false,\n  };\n}\n\n// export const updateMobxObservable = action(<T>(oldObject: T, newObject: T) => {\n//   Object.keys(oldObject).forEach((k) => {\n//     const key: Extract<keyof T, string> = k as any;\n//     const oldValue = oldObject[key];\n//     const newValue = newObject[key];\n//     if (newValue !== oldValue) {\n//       let val = newObject[key];\n//       val = (typeof val).toString() === 'object' ? observable(val) : val;\n//       oldObject[key] = val;\n//     }\n//   });\n// });\n\nexport const goToNode = action(<S, A>(graph: ProvenanceGraph<S, A>, id: NodeID) => {\n  const newCurrentNode = graph.nodes[id];\n  if (!newCurrentNode) throw new Error(`Node with id: ${id} does not exist`);\n  graph.current = newCurrentNode.id;\n});\n\nexport const applyActionFunction = action(\n  <T, S, A>(\n    _graph: ProvenanceGraph<S, A>,\n    actionFn: ApplyObject<T, S>,\n    currentState: T,\n    // eslint-disable-next-line no-unused-vars\n    serialize: Serializer<T>,\n    customLabel?: string,\n  ) => {\n    const graph = _graph;\n\n    const { current: currentId } = graph;\n    const currentNode = graph.nodes[currentId];\n    let previousState: JsonValue | null = null;\n    let previousStateID: NodeID | null = null;\n\n    if (isDiffNode(currentNode)) {\n      previousState = getState(graph, graph.nodes[currentNode.lastStateNode]);\n      previousStateID = currentNode.lastStateNode;\n    } else {\n      previousState = getState(graph, currentNode);\n      previousStateID = currentNode.id;\n    }\n\n    let saveDiff = isChildNode(currentNode);\n\n    const { state, stateSaveMode, actionType, label, eventType, meta } = actionFn.apply(\n      currentState,\n      customLabel,\n    );\n\n    const parentId = graph.current;\n\n    const serializedState = serialize(state);\n\n    const diffs = differ(previousState, serializedState) || [];\n\n    if (saveDiff && Object.keys(previousState).length / 2 < diffs.length) {\n      saveDiff = false;\n    }\n\n    saveDiff = saveDiff && stateSaveMode === 'Diff';\n\n    const newNode = saveDiff\n      ? createNewDiffNode<S, A>(\n          parentId,\n          label,\n          diffs,\n          actionType,\n          previousStateID,\n          eventType,\n          meta,\n        )\n      : createNewStateNode<S, A>(parentId, serializedState, label, actionType, eventType, meta);\n\n    graph.nodes[newNode.id] = newNode;\n    graph.nodes[currentId].children.push(newNode.id);\n    graph.current = newNode.id;\n\n    return graph.nodes[graph.current];\n    // End\n  },\n);\n\nexport const importState = action(\n  <S, A>(graph: ProvenanceGraph<S, A>, importedState: JsonValue) => {\n    const newNode = createNewStateNode(\n      graph.current,\n      importedState,\n      'Import',\n      'Regular',\n      (null as unknown) as S,\n      {},\n    );\n\n    graph.nodes[newNode.id] = newNode;\n    graph.current = newNode.id;\n  },\n);\n","import { compressToEncodedURIComponent, decompressFromEncodedURIComponent } from 'lz-string';\nimport { action, computed, configure, makeAutoObservable, reaction, toJS } from 'mobx';\nimport { ProvenanceGraph } from '..';\nimport { ApplyObject } from '../Types/Action';\nimport { getState, isChildNode, ProvenanceNode, RootNode } from '../Types/Nodes';\nimport { GlobalObserver } from '../Types/Observers';\nimport { Provenance, ProvenanceOpts } from '../Types/Provenance';\nimport { JsonValue, Serializer } from '../Types/Serializers';\nimport defaultDeserializer from '../Utils/defaultDeserializer';\nimport defaultSerializer from '../Utils/defaultSerializer';\nimport generateTimeStamp from '../Utils/generateTimeStamp';\nimport { NodeID } from './../Types/Nodes';\nimport { ChangeType, ObserverEffect, ObserverExpression } from './../Types/Observers';\nimport {\n  applyActionFunction,\n  createProvenanceGraph,\n  goToNode,\n  importState,\n} from './ProvenanceGraphFunction';\n\nconfigure({\n  enforceActions: 'always',\n  isolateGlobalState: true,\n});\n\nconst PROVSTATEKEY = 'provState';\n\nfunction createStore<T, S, A>(initState: T, serializer: Serializer<T>) {\n  const obs = makeAutoObservable(createProvenanceGraph<S, A>(serializer(initState)));\n  return obs;\n}\n\n/**\n * @template T Represents the given state of an application as defined in initProvenance.\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n * @template A Represents the given \"extra\" type for storing metadata.\n * Extra is a way to store customized metadata.\n * @param initialState: Initial state for the provenance graph to be created in.\n *  State of the root node.\n * @param _opts: Specify whether or not to loadFromUrl, or utilize firebase integration.\n */\nexport default function initProvenance<T, S, A = void>(\n  initialState: T,\n  _opts: Partial<ProvenanceOpts<T>> = {},\n): Provenance<T, S, A> {\n  const opts: ProvenanceOpts<T> = {\n    loadFromUrl: false,\n    firebaseConfig: null,\n    _serializer: undefined,\n    _deserializer: undefined,\n    ..._opts,\n  };\n\n  let setupFinished = false;\n\n  const { loadFromUrl, _serializer, _deserializer } = opts;\n\n  const serializer = _serializer !== undefined ? _serializer : defaultSerializer;\n\n  const deserializer = _deserializer !== undefined ? _deserializer : defaultDeserializer;\n\n  const graph = createStore<T, S, A>(initialState, serializer);\n\n  const state = computed(() => deserializer(getState(graph, graph.nodes[graph.current])));\n\n  if (loadFromUrl)\n    reaction(\n      () => state.get(),\n      (state) => {\n        const url = new URL(window.location.href);\n        const params = new URLSearchParams(url.search);\n        const stateEncodedString = compressToEncodedURIComponent(JSON.stringify(serializer(state)));\n        params.set(PROVSTATEKEY, stateEncodedString);\n        window.history.replaceState({}, '', `${url.pathname}?${params}`);\n      },\n    );\n\n  return {\n    get state() {\n      return state.get();\n    },\n    get config() {\n      return opts;\n    },\n    get graph() {\n      return graph;\n    },\n    get current() {\n      return graph.nodes[graph.current];\n    },\n    get root() {\n      return graph.nodes[graph.root] as RootNode<S>;\n    },\n    get usingDefaultSerializer() {\n      return _serializer === undefined && _deserializer === undefined;\n    },\n    apply(action: ApplyObject<T, S>, label?: string) {\n      if (!setupFinished)\n        throw new Error(\n          'Provenance setup not finished. Please call done function on provenance object after setting up any observers.)',\n        );\n\n      applyActionFunction(graph, action, state.get(), serializer, label);\n      // ! Add firebase\n    },\n    addGlobalObserver(observer: GlobalObserver<S, A>) {\n      reaction(\n        () => toJS(graph),\n        (currentGraph, previousGraph) => {\n          let change: ChangeType = 'Any';\n          if (Object.keys(currentGraph.nodes).length > Object.keys(previousGraph.nodes).length)\n            change = 'NodeAdded';\n          else if (currentGraph.current !== previousGraph.current) change = 'CurrentChanged';\n\n          observer(currentGraph, change);\n        },\n      );\n    },\n    addObserver<P>(expression: ObserverExpression<T, P>, effect: ObserverEffect<P>) {\n      reaction(\n        () => expression(state.get()),\n        (current, previous) => effect(current, previous),\n      );\n    },\n    goToNode(id: NodeID) {\n      goToNode(graph, id);\n    },\n    addArtifact: action('Add Artifact Action', (artifact: A, _id?: NodeID) => {\n      let id = graph.current;\n      if (_id) id = _id;\n\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        node.artifacts.customArtifacts.push({\n          timestamp: generateTimeStamp(),\n          artifact,\n        });\n      }\n    }),\n    addAnnotation: action('Add Annotation Action', (annotation: string, _id?: NodeID) => {\n      let id = graph.current;\n      if (_id) id = _id;\n\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        node.artifacts.annotations.push({\n          timestamp: generateTimeStamp(),\n          annotation,\n        });\n      }\n    }),\n    getAllArtifacts(_id?: NodeID) {\n      let id = graph.current;\n      if (_id) id = _id;\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        return toJS(node.artifacts.customArtifacts);\n      }\n      return [];\n    },\n    getLatestArtifact(_id?: NodeID) {\n      let id = graph.current;\n      if (_id) id = _id;\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        const arts = node.artifacts.customArtifacts;\n        return toJS(arts[arts.length - 1]);\n      }\n      return null;\n    },\n    getAllAnnotation(_id?: NodeID) {\n      let id = graph.current;\n      if (_id) id = _id;\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        return toJS(node.artifacts.annotations);\n      }\n      return [];\n    },\n    getLatestAnnotation(_id?: NodeID) {\n      let id = graph.current;\n      if (_id) id = _id;\n      const node = graph.nodes[id];\n\n      if (isChildNode(node)) {\n        const { annotations } = node.artifacts;\n        return toJS(annotations[annotations.length - 1]);\n      }\n      return null;\n    },\n    undo() {\n      const current = this.current;\n      if (!isChildNode(current)) console.warn('Already at Root');\n      else goToNode(graph, current.parent);\n    },\n    redo(to: 'latest' | 'oldest' = 'latest') {\n      const current = this.current;\n\n      if (current.children.length === 0) {\n        console.warn('Already at latest node in this branch.');\n      } else {\n        let id = current.children[current.children.length - 1];\n        if (to === 'oldest') id = current.children[0];\n\n        goToNode(graph, id);\n      }\n    },\n    goBackOneStep() {\n      this.undo();\n    },\n    goForwardOneStep(to: 'latest' | 'oldest' = 'latest') {\n      this.redo(to);\n    },\n    undoNonEphemeral() {\n      this.goBackToNonEphemeral();\n    },\n    goBackToNonEphemeral() {\n      let parent: NodeID | null = null;\n      const current = graph.nodes[graph.current];\n      if (isChildNode(current)) {\n        parent = current.parent;\n\n        while (graph.nodes[parent].actionType === 'Ephemeral') {\n          const parentNode: ProvenanceNode<S, A> = graph.nodes[parent];\n          if (!isChildNode(parentNode)) break;\n          parent = parentNode.parent;\n        }\n\n        goToNode(graph, parent);\n      }\n    },\n    redoNonEphemeral(to: 'latest' | 'oldest' = 'latest') {\n      this.goForwardToNonEphemeral(to);\n    },\n    goForwardToNonEphemeral(to: 'latest' | 'oldest' = 'latest') {\n      let child: NodeID | null = null;\n      const current = graph.nodes[graph.current];\n\n      if (current.children.length === 0) {\n        throw new Error('Already at latest node.');\n      }\n      child = current.children[to === 'latest' ? current.children.length - 1 : 0];\n\n      while (graph.nodes[child].actionType === 'Ephemeral') {\n        const childNode: ProvenanceNode<S, A> = graph.nodes[child];\n        if (childNode.children.length === 0) break;\n        child = childNode.children[to === 'latest' ? childNode.children.length - 1 : 0];\n      }\n\n      goToNode(graph, child);\n    },\n    reset() {\n      goToNode(graph, graph.root);\n    },\n    setBookmark: action('Bookmark Action', (id: NodeID, bookmark: boolean) => {\n      graph.nodes[id].bookmarked = bookmark;\n    }),\n    getBookmark(id: NodeID) {\n      return graph.nodes[id].bookmarked;\n    },\n    getAllBookmarks() {\n      return Object.entries(graph.nodes)\n        .filter((entry) => entry[1].bookmarked)\n        .map((d) => d[0] as NodeID);\n    },\n    exportState(partial = false) {\n      let exportedState: JsonValue = {};\n\n      const currentState = getState(graph, this.current);\n\n      const initState = serializer(initialState);\n\n      if (partial) {\n        Object.keys(initState).forEach((k) => {\n          const prev = initState[k];\n          const curr = currentState[k];\n          if (JSON.stringify(prev) !== JSON.stringify(curr)) {\n            exportedState = { ...exportedState, [k]: currentState[k] };\n          }\n        });\n      } else {\n        exportedState = currentState;\n      }\n\n      const compressedString = compressToEncodedURIComponent(JSON.stringify(exportedState));\n\n      return compressedString;\n    },\n    importState(s: string | JsonValue) {\n      let state: JsonValue;\n      if (typeof s === 'string') {\n        state = JSON.parse(decompressFromEncodedURIComponent(s) || '{}');\n      } else {\n        state = { ...this.state, ...s };\n      }\n\n      importState(graph, state);\n    },\n    exportProvenanceGraph() {\n      return JSON.stringify(toJS(graph));\n    },\n    importProvenanceGraph: action(\n      'Import Provenance Graph',\n      (g: string | ProvenanceGraph<S, A>) => {\n        let importedGraph: ProvenanceGraph<S, A>;\n        if (typeof g === 'string') importedGraph = JSON.parse(g);\n        else importedGraph = g;\n\n        graph.current = importedGraph.current;\n        graph.root = importedGraph.root;\n        graph.nodes = importedGraph.nodes;\n      },\n    ),\n    getState(node: ProvenanceNode<S, A> | NodeID) {\n      let n: ProvenanceNode<S, A>;\n      if (typeof node === 'string') {\n        n = graph.nodes[node];\n      } else {\n        n = node;\n      }\n\n      return deserializer(getState(graph, n));\n    },\n    done() {\n      setupFinished = true;\n      if (loadFromUrl) {\n        if (!window?.location?.href)\n          throw new Error('loadFromUrl option can only be used in a browser environment');\n\n        const url = new URL(window.location.href);\n        const params = new URLSearchParams(url.search);\n        const importString = params.get(PROVSTATEKEY);\n        if (!importString) return;\n\n        this.importState(importString);\n      }\n    },\n  };\n}\n","/* eslint-disable func-names */\n/* eslint-disable no-underscore-dangle */\nimport { action, toJS } from 'mobx';\nimport { ActionFunction, ActionObject, ActionSaveStateMode, ActionType } from '../Types/Action';\nimport { Meta } from '../Types/Nodes';\n\n/**\n *\n * @template T State of the application\n * @template S Represents the given event types in your application.\n * Event types are used to differentiate between different actions that create nodes.\n *\n * @param func Defines the function which will be executed on provenance apply\n *\n */\n\n// TODO:: Switch Args and S here.\nexport default function createAction<T, Args extends unknown[] = unknown[], S = void>(\n  func: ActionFunction<T, Args>,\n): ActionObject<T, S, Args> {\n  let _label: string | undefined;\n  let _actionType: ActionType = 'Regular';\n  let _stateSaveMode: ActionSaveStateMode = 'Diff';\n  let _eventType: S;\n  let _meta: Meta = {};\n\n  const actionObject: ActionObject<T, S, Args> = (...args: Args) => {\n    return {\n      apply: action((state: T, label?: string) => {\n        if (!_label) throw new Error('Please specify a default label when you create the action');\n\n        if (!label) label = _label;\n\n        func(state, ...args);\n        return {\n          state: toJS(state),\n          label: label,\n          stateSaveMode: _stateSaveMode,\n          actionType: _actionType,\n          eventType: _eventType,\n          meta: _meta,\n        };\n      }),\n    };\n  };\n\n  actionObject.setLabel = function (label: string) {\n    _label = label;\n    return this;\n  };\n\n  actionObject.setActionType = function (actionType: ActionType) {\n    _actionType = actionType;\n    return this;\n  };\n\n  actionObject.saveStateMode = function (mode: ActionSaveStateMode) {\n    _stateSaveMode = mode;\n    return this;\n  };\n\n  actionObject.setEventType = function (evtType: S) {\n    _eventType = evtType;\n    return this;\n  };\n\n  actionObject.setMetaData = function (m: Meta) {\n    _meta = m;\n    return this;\n  };\n\n  return actionObject;\n}\n"],"names":["deepCopy","target","JSON","parse","stringify","isStateNode","node","isDiffNode","isChildNode","isRootNode","label","getState","graph","toJS","state","_state","nodes","lastStateNode","diffs","forEach","diff","applyChange","defaultDeserializer","o","str","obj","_","val","type","Set","arr","Map","Object","entries","defaultSerializer","Array","from","fromEntries","generateTimeStamp","Date","getTime","differ","obj1","obj2","generateUUID","d","valueOf","replace","c","r","Math","random","floor","toString","createProvenanceGraph","root","id","metadata","createdOn","eventType","children","actionType","bookmarked","current","createNewStateNode","parent","meta","artifacts","annotations","customArtifacts","createNewDiffNode","previousStateId","goToNode","action","newCurrentNode","Error","applyActionFunction","_graph","actionFn","currentState","serialize","customLabel","currentId","currentNode","previousState","previousStateID","saveDiff","apply","stateSaveMode","parentId","serializedState","keys","length","newNode","push","importState","importedState","configure","enforceActions","isolateGlobalState","PROVSTATEKEY","createStore","initState","serializer","obs","makeAutoObservable","initProvenance","initialState","_opts","opts","loadFromUrl","firebaseConfig","_serializer","undefined","_deserializer","setupFinished","deserializer","computed","reaction","get","url","URL","window","location","href","params","URLSearchParams","search","stateEncodedString","compressToEncodedURIComponent","set","history","replaceState","pathname","config","usingDefaultSerializer","addGlobalObserver","observer","currentGraph","previousGraph","change","addObserver","expression","effect","previous","addArtifact","artifact","_id","timestamp","addAnnotation","annotation","getAllArtifacts","getLatestArtifact","arts","getAllAnnotation","getLatestAnnotation","undo","console","warn","redo","to","goBackOneStep","goForwardOneStep","undoNonEphemeral","goBackToNonEphemeral","parentNode","redoNonEphemeral","goForwardToNonEphemeral","child","childNode","reset","setBookmark","bookmark","getBookmark","getAllBookmarks","filter","entry","map","exportState","partial","exportedState","k","prev","curr","compressedString","s","decompressFromEncodedURIComponent","exportProvenanceGraph","importProvenanceGraph","g","importedGraph","n","done","importString","createAction","func","_label","_actionType","_stateSaveMode","_eventType","_meta","actionObject","args","setLabel","setActionType","saveStateMode","mode","setEventType","evtType","setMetaData","m"],"mappings":"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"}